#!/bin/bash

git_update="pwd"
git_status=""
mvn_build=""
init=""
while getopts "bgsti" OPT;
do
	case $OPT in
		i)
			echo Initializing .pommit_projs
			find . -type d -maxdepth 1 -exec echo 'PROJS="$PROJS {}"' ';' | tee .pommit_projs
			echo done
			exit 0
			;;
		b)
			mvn_build="mvn clean install"
			;;
		g)
			git_update="git pull --rebase"
			;;
		s)
			git_status="git status -sb"
			;;
		t)
			git_status="git stash list"
			;;
	esac
done

if [[ -f .pommit_projs ]];
then
	. .pommit_projs
else
	echo "Not initalized."
	exit 1
fi

if [[ ! -z "$git_status" ]];
then
	for pro in $PROJS;
	do
		(cd $pro; pwd; $git_status; echo -e "";)
	done
	exit 1
fi

for pro in $PROJS; 
do
	(cd $pro; $git_update; $mvn_build)
done
